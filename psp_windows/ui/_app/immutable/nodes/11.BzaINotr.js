import{l as Co,h as Po,c as It,b as f,p as N,f as k,g as To,i as ht,d as w,a as eo}from"../chunks/CAJyC1Oe.js";import{f as ot,p as io,m as W,x as Ao,e as uo,g as a,u as M,s as O,a as Oo,b as p,c as i,d as E,t as Et,n as so,r as l}from"../chunks/BNhJgPkb.js";import{I as Eo,b as Lo,n as v,g as po,o as Lt,f as St,q as ro,r as yt,t as no,u as lo}from"../chunks/E3TZ2KYB.js";import{b as Y,s as tt,A as Ut}from"../chunks/DYcuc4uV.js";import{m as $}from"../chunks/DkCIVBzI.js";import{a as Io}from"../chunks/DOxkAmvL.js";function So(u,s){const o=Co(s,["children","$$slots","$$events","$$legacy"]);Eo(u,Po({name:"target"},()=>o,{iconNode:[["circle",{cx:"12",cy:"12",r:"10"}],["circle",{cx:"12",cy:"12",r:"6"}],["circle",{cx:"12",cy:"12",r:"2"}]],children:(C,D)=>{var L=It(),R=ot(L);Lo(R,s,"default",{},null),f(C,L)},$$slots:{default:!0}}))}const vo=123930,xo=157935,Nt=459,bt=8192,No=-1951,Do=-1893,Ro=1198,Xo=1243,Vt=0,qt=0,jo=Ro-No,Bo=Xo-Do,wt=bt/jo,Mt=5075.45,$t=-8192/Bo,kt=4960.62;function g(u,s){const o=Math.round((s-xo)/Nt),_=Math.round((u+vo)/Nt)*-1;return{x:o,y:_}}function Jt(u,s){const o=s*-1*Nt-vo,_=u*Nt+xo;return{x:o,y:_}}function P(u,s){const o=g(u,s),_=wt*o.x+Mt,C=$t*o.y+kt;return v.latLng(C,_)}function co(u){const s=(u.lng-Mt)/wt,o=(u.lat-kt)/$t,_=Jt(s,o);return{worldX:_.x,worldY:_.y}}var Wo=k('<div class="h-full w-full" id="map"></div>');function Yo(u,s){io(s,!0);let o=N(s,"map",15),_=N(s,"showOrigin",3,!1),C=N(s,"showPlayers",3,!0),D=N(s,"showBases",3,!0),L=N(s,"showFastTravel",3,!0),R=N(s,"showDungeons",3,!0),at=N(s,"showAlphaPals",3,!0),et=N(s,"showPredatorPals",3,!0);const st=po(),z=M(()=>{const e=Jt(Vt,qt),t=P(e.x,e.y);return[t.lat,t.lng]}),Ft=v.extend({},v.CRS.Simple,{transformation:new v.Transformation(wt,Mt,$t,kt)}),G=[[0,0],[bt,bt]];let X=[],H=[],rt=[],nt=[],lt=[],ct=[],it=[];const Dt={center:[0,0],crs:Ft,minZoom:-4,maxZoom:3,maxBounds:G,maxBoundsViscosity:1};function Rt(){return v.icon({iconUrl:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23FFFFFF' stroke-width='2'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Cline x1='12' y1='2' x2='12' y2='22' stroke='%23FFFFFF' stroke-width='2'/%3E%3Cline x1='2' y1='12' x2='22' y2='12' stroke='%23FFFFFF' stroke-width='2'/%3E%3C/svg%3E",iconSize:[24,24],iconAnchor:[12,12],popupAnchor:[0,-12]})}function Ct(){if(!o()||(X.forEach(q=>o().removeLayer(q)),X=[],!_()))return;const e=Jt(Vt,qt),t=P(e.x,e.y),n=Rt(),r=v.marker(t,{icon:n}).addTo(o());r.bindPopup(`
            <div>
                <h3 class="text-lg font-bold">Origin (0,0)</h3>
                <p>This is the origin (0,0) in map coordinates</p>
                <p class="text-xs mt-2">World Coords: ${e.x.toFixed(2)}, ${e.y.toFixed(2)}</p>
                <p class="text-xs">Map Coords: ${Vt}, ${qt}</p>
                <p class="text-xs">Leaflet Coords: ${t.lat.toFixed(2)}, ${t.lng.toFixed(2)}</p>
            </div>
        `),X.push(r);const d=v.polyline([[t.lat,0],[t.lat,bt]],{color:"rgba(255, 255, 255, 0.5)",weight:1,dashArray:"5,5"}).addTo(o()),x=v.polyline([[0,t.lng],[bt,t.lng]],{color:"rgba(255, 255, 255, 0.5)",weight:1,dashArray:"5,5"}).addTo(o());X.push(d),X.push(x)}function Z(){if(!o()||(rt.forEach(r=>o().removeLayer(r)),rt=[],!D()))return;const t=Object.values(st.guilds||{}).reduce((r,d)=>(d.bases&&Object.values(d.bases).forEach(x=>{r.push(x)}),r),[]),n=Lt.baseCamp;t.forEach(r=>{if(!r.location)return;const d=P(r.location.x,r.location.y),x=v.marker(d,{icon:n}).addTo(o());x.bindPopup(`
            <div>
                <h3 class="text-lg font-bold">${r.id}</h3>
                <p class="text-xs mt-2">World Coords: ${r.location.x.toFixed(2)}, ${r.location.y.toFixed(2)}</p>
                <p class="text-xs">Map Coords: ${g(r.location.x,r.location.y).x}, ${g(r.location.x,r.location.y).y*-1}</p>
            </div>
        `),rt.push(x)})}function U(){if(!o()||(H.forEach(n=>o().removeLayer(n)),H=[],!C()))return;const e=Object.values(st.players||{}),t=Lt.player;e.forEach(n=>{if(!n.location)return;const r=P(n.location.x,n.location.y),d=v.marker(r,{icon:t}).addTo(o());d.bindPopup(`
                <div>
                    <h3 class="text-lg font-bold">${n.nickname}</h3>
					<p class="text-xs">Last Online: ${new Date(n.last_online_time).toLocaleString()}</p>
                    <p class="text-xs">Level: ${n.level}</p>
                    <p class="text-xs">HP: ${n.hp}</p>
                    <p class="text-xs mt-2">World Coords: ${n.location.x.toFixed(2)}, ${n.location.y.toFixed(2)}, ${n.location.z.toFixed(2)}</p>
                    <p class="text-xs">Map Coords: ${g(n.location.x,n.location.y).x}, ${g(n.location.x,n.location.y).y*-1}</p>
                </div>
            `),H.push(d)})}async function dt(){if(!o()||(nt.forEach(t=>o().removeLayer(t)),nt=[],!L())||!$)return;const e=Lt.fastTravel;$.points.filter(t=>t.type==="fast_travel").forEach(t=>{const n=P(t.x,t.y),r=v.marker(n,{icon:e}).addTo(o());r.bindPopup(`
					<div>
						<h3 class="text-lg font-bold">${t.localized_name}</h3>
						<p class="text-xs mt-2">World Coords: ${t.x.toFixed(2)}, ${t.y.toFixed(2)}</p>
						<p class="text-xs">Map Coords: ${g(t.x,t.y).x}, ${g(t.x,t.y).y*-1}</p>
					</div>
				`),nt.push(r)})}async function V(){if(!o()||(lt.forEach(t=>o().removeLayer(t)),lt=[],!R())||!$)return;const e=Lt.dungeon;$.points.filter(t=>t.type==="dungeon").forEach(t=>{const n=P(t.x,t.y),r=v.marker(n,{icon:e}).addTo(o());r.bindPopup(`
					<div>
						<p class="text-xs mt-2">World Coords: ${t.x.toFixed(2)}, ${t.y.toFixed(2)}</p>
						<p class="text-xs">Map Coords: ${g(t.x,t.y).x}, ${g(t.x,t.y).y*-1}</p>
					</div>
				`),lt.push(r)})}async function ut(){o()&&(ct.forEach(e=>o().removeLayer(e)),ct=[],at()&&$&&$.points.filter(e=>e.type==="alpha_pal").forEach(e=>{const t=P(e.x,e.y),n=St.loadMenuImage(e.pal),r=ro.pals[e.pal],d=v.icon({iconUrl:n,iconSize:[40,40],iconAnchor:[20,20],popupAnchor:[0,-20],className:"rounded-full border-2 border-white"}),x=v.marker(t,{icon:d}).addTo(o());x.bindPopup(`
					<div>
						<h3 class="text-lg font-bold">${r?r.localized_name:e.pal}</h3>
						<p class="text-xs mt-2">World Coords: ${e.x.toFixed(2)}, ${e.y.toFixed(2)}</p>
						<p class="text-xs">Map Coords: ${g(e.x,e.y).x}, ${g(e.x,e.y).y*-1}</p>
					</div>
				`),ct.push(x)}))}async function I(){o()&&(it.forEach(e=>o().removeLayer(e)),it=[],et()&&$&&$.points.filter(e=>e.type==="predator_pal").forEach(e=>{const t=P(e.x,e.y),n=St.loadMenuImage(e.pal),r=ro.pals[e.pal],d=v.icon({iconUrl:n,iconSize:[40,40],iconAnchor:[20,20],popupAnchor:[0,-20],className:"rounded-full border-2 border-red-500"}),x=v.marker(t,{icon:d}).addTo(o());x.bindPopup(`
					<div>
						<h3 class="text-lg font-bold">${r?r.localized_name:e.pal}</h3>
						<p class="text-xs mt-2">World Coords: ${e.x.toFixed(2)}, ${e.y.toFixed(2)}</p>
						<p class="text-xs">Map Coords: ${g(e.x,e.y).x}, ${g(e.x,e.y).y*-1}</p>
					</div>
				`),it.push(x)}))}function pt(e){o(v.map(e,Dt)),v.imageOverlay(yt.worldMap,G).addTo(o()),o().fitBounds(G),o().on("click",t=>{var Pt;const n=(Pt=o())==null?void 0:Pt.getZoom(),r=t.latlng,d=co(r),x=(r.lng-Mt)/wt,q=(r.lat-kt)/$t*-1;console.log(`Zoom level: ${n}`),console.log(`Leaflet coords: [${r.lat.toFixed(2)}, ${r.lng.toFixed(2)}]`),console.log(`World coords: [${d.worldX.toFixed(2)}, ${d.worldY.toFixed(2)}]`),console.log(`Game Map coords: [${Math.round(x)}, ${Math.round(q)}]`)}),o().on("zoomend",()=>{var t;console.log(`New zoom level: ${(t=o())==null?void 0:t.getZoom()}`)}),o().setView(a(z),-3),Ct(),U(),Z(),dt(),V(),ut(),I(),j()}function j(){if(!o())return;const e=v.Control.extend({options:{position:"bottomright"},onAdd(){const t=v.DomUtil.create("div","coordinate-display");return t.style.backgroundColor="rgba(0, 0, 0, 0.7)",t.style.color="white",t.style.padding="5px 10px",t.style.borderRadius="4px",t.style.margin="0",t.style.fontFamily="monospace",t.style.fontSize="12px",t.style.lineHeight="1.4",t.innerHTML="Coordinates: 0, 0",t}});o().addControl(new e),o().on("mousemove",function(t){const n=document.querySelector(".coordinate-display");if(n){const r=co(t.latlng),d=(t.latlng.lng-Mt)/wt,x=(t.latlng.lat-kt)/$t*-1;n.innerHTML=`
                    World: ${Math.round(r.worldX)}, ${Math.round(r.worldY)}<br>
                    Map: ${Math.round(d)}, ${Math.round(x)}
                `}})}W(()=>{o()&&Ct()}),W(()=>{o()&&U()}),W(()=>{o()&&Z()}),W(()=>{o()&&dt()}),W(()=>{o()&&V()}),W(()=>{o()&&ut()}),W(()=>{o()&&I()}),Ao(()=>{o()&&(o().remove(),o(void 0))});var vt=Wo();Io(vt,e=>pt==null?void 0:pt(e)),f(u,vt),uo()}var zo=(u,s)=>E(s,!a(s)),Go=(u,s)=>E(s,!a(s)),Ho=(u,s)=>E(s,!a(s)),Zo=(u,s)=>E(s,!a(s)),Uo=k('<button><img alt="Players" class="mr-2 h-6 w-6"/> <span>Players</span> <span class="text-surface-500 text-xs"> </span></button> <button><img alt="Bases" class="mr-2 h-6 w-6"/> <span>Bases</span> <span class="text-surface-500 text-xs"> </span></button>',1),Vo=(u,s)=>E(s,!a(s)),qo=(u,s)=>E(s,!a(s)),Jo=(u,s)=>E(s,!a(s)),Ko=k('<h2 class="text-lg font-bold">Players</h2>'),Qo=(u,s,o)=>s(a(o)),ta=k('<button class="bg-surface-800 hover:bg-secondary-500/25 w-full rounded-sm p-2 text-start"><div class="font-bold"> </div> <div class="text-xs"> </div> <div class="text-xs text-gray-400"> </div> <div class="text-xs text-gray-400"> </div></button>'),oa=k('<div class="max-h-64 space-y-2 overflow-y-auto"></div>'),aa=k('<p class="text-sm text-gray-500">No players found.</p>'),ea=k('<h2 class="text-lg font-bold">Bases</h2>'),sa=(u,s,o)=>s(a(o)),ra=k('<button class="bg-surface-800 hover:bg-secondary-500/25 mb-2 w-full rounded-sm p-2 text-start"><div class="font-bold"> </div> <div class="text-xs text-gray-400"> </div></button>'),na=k('<div class="max-h-64 space-y-2 overflow-y-auto"></div>'),la=k('<p class="text-sm text-gray-500">No bases found.</p>'),ca=k("<!> <!>",1),ia=k('<div class="grid h-full grid-cols-[25%_1fr] gap-2"><div class="flex flex-col gap-4 p-4"><div class="flex flex-col gap-2"><h1 class="text-2xl font-bold">World Map</h1> <p class="text-sm text-gray-500">Explore the world of Palworld.</p></div> <div class="flex flex-col gap-4"><div class="flex flex-col gap-2"><h2 class="text-lg font-bold">Map Controls</h2> <div class="grid grid-cols-2 gap-2"><button><!> <span>Origin</span></button> <button><img alt="Fast Travel" class="mr-2 h-6 w-6"/> <span>Fast Travel</span> <span class="text-surface-500 text-xs"> </span></button> <!> <button><img alt="Dungeons" class="mr-2 h-6 w-6"/> <span>Dungeons</span> <span class="text-surface-500 text-xs"> </span></button> <button><img alt="Alpha Pals" class="mr-2 h-6 w-6"/> <span>Alpha Pals</span> <span class="text-surface-500 text-xs"> </span></button> <button><img alt="Predator Pals" class="mr-2 h-6 w-6"/> <span>Predator Pals</span> <span class="text-surface-500 text-xs"> </span></button></div></div> <!> <div class="mt-auto flex flex-col gap-2"><p class="text-sm text-gray-500">Click on the map to see detailed coordinates.</p></div></div></div> <!></div>');function ga(u,s){io(s,!0);const o=po();let _=O(!1),C=O(!0),D=O(!0),L=O(!0),R=O(!0),at=O(!0),et=O(!0),st=O(Oo(["players"])),z=O(void 0);const Ft=M(()=>Object.values(o.players||{})),G=M(()=>a(Ft).length),X=M(()=>Object.values(o.guilds||{})),H=M(()=>Object.values(a(X)).reduce((c,y)=>(y.bases&&Object.values(y.bases).forEach(m=>{c[m.id]=m}),c),{})),rt=M(()=>Object.values($.points).filter(c=>c.type==="fast_travel").length||0),nt=M(()=>Object.values($.points).filter(c=>c.type==="dungeon").length||0),lt=M(()=>Object.values($.points).filter(c=>c.type==="alpha_pal").length||0),ct=M(()=>Object.values($.points).filter(c=>c.type==="predator_pal").length||0),it=M(()=>St.loadMenuImage("anubis")),Dt=M(()=>St.loadMenuImage("nightbluehorse"));function Rt(c){var m;const y=P(c.location.x,c.location.y);(m=a(z))==null||m.flyTo(y,3)}function Ct(c){var m;const y=P(c.location.x,c.location.y);(m=a(z))==null||m.flyTo(y,3)}var Z=ia(),U=i(Z),dt=p(i(U),2),V=i(dt),ut=p(i(V),2),I=i(ut);I.__click=[zo,_];var pt=i(I);So(pt,{class:"mr-2 h-6 w-6"}),so(2),l(I);var j=p(I,2);j.__click=[Go,L];var vt=i(j),e=p(vt,4),t=i(e,!0);l(e),l(j);var n=p(j,2);{var r=c=>{var y=Uo(),m=ot(y);m.__click=[Ho,C];var ft=i(m),gt=p(ft,4),Xt=i(gt,!0);l(gt),l(m);var S=p(m,2);S.__click=[Zo,D];var J=i(S),At=p(J,4),jt=i(At,!0);l(At),l(S),Et(T=>{Y(m,1,`flex items-center space-x-2 ${a(C)?"":"opacity-25"}`),tt(ft,"src",yt.player),w(Xt,a(G)),Y(S,1,`flex items-center space-x-2 ${a(D)?"":"opacity-25"}`),tt(J,"src",yt.baseCamp),w(jt,T)},[()=>Object.keys(a(H)).length]),f(c,y)};ht(n,c=>{o.saveFile&&c(r)})}var d=p(n,2);d.__click=[Vo,R];var x=i(d),q=p(x,4),Pt=i(q,!0);l(q),l(d);var xt=p(d,2);xt.__click=[qo,at];var Kt=i(xt),Qt=p(Kt,4),fo=i(Qt,!0);l(Qt),l(xt);var Tt=p(xt,2);Tt.__click=[Jo,et];var to=i(Tt),oo=p(to,4),go=i(oo,!0);l(oo),l(Tt),l(ut),l(V);var _o=p(V,2);{var mo=c=>{Ut(c,{get value(){return a(st)},onValueChange:y=>E(st,y.value,!0),collapsible:!0,children:(y,m)=>{var ft=ca(),gt=ot(ft);eo(gt,()=>Ut.Item,(S,J)=>{J(S,{value:"players",controlHover:"hover:bg-secondary-500/25",control:T=>{var A=Ko();f(T,A)},panel:T=>{var A=It(),Bt=ot(A);{var Wt=b=>{var F=oa();no(F,21,()=>a(Ft),lo,(zt,h)=>{var B=It(),_t=ot(B);{var Gt=K=>{var Q=ta();const Ot=M(()=>g(a(h).location.x,a(h).location.y));Q.__click=[Qo,Rt,h];var mt=i(Q),yo=i(mt,!0);l(mt);var Ht=p(mt,2),bo=i(Ht);l(Ht);var Zt=p(Ht,2),wo=i(Zt);l(Zt);var ao=p(Zt,2),Mo=i(ao);l(ao),l(Q),Et(($o,ko,Fo)=>{w(yo,a(h).nickname),w(bo,`Level: ${a(h).level??""} | HP: ${a(h).hp??""}`),w(wo,`Location: ${$o??""}, ${ko??""}`),w(Mo,`Last Online: ${Fo??""}`)},[()=>Math.round(a(Ot).x),()=>Math.round(a(Ot).y),()=>new Date(a(h).last_online_time).toLocaleString()]),f(K,Q)};ht(_t,K=>{a(h).location&&K(Gt)})}f(zt,B)}),l(F),f(b,F)},Yt=b=>{var F=aa();f(b,F)};ht(Bt,b=>{a(C)&&a(G)>0?b(Wt):b(Yt,!1)})}f(T,A)},$$slots:{control:!0,panel:!0}})});var Xt=p(gt,2);eo(Xt,()=>Ut.Item,(S,J)=>{J(S,{value:"bases",controlHover:"hover:bg-secondary-500/25",control:T=>{var A=ea();f(T,A)},panel:T=>{var A=It(),Bt=ot(A);{var Wt=b=>{var F=na();no(F,21,()=>Object.values(a(H)),lo,(zt,h)=>{var B=ra();B.__click=[sa,Ct,h];var _t=i(B),Gt=i(_t,!0);l(_t);var K=p(_t,2),Q=i(K);l(K),l(B),Et((Ot,mt)=>{w(Gt,a(h).id),w(Q,`Location: ${Ot??""}, ${mt??""}`)},[()=>g(a(h).location.x,a(h).location.y).x,()=>g(a(h).location.x,a(h).location.y).y]),f(zt,B)}),l(F),f(b,F)},Yt=b=>{var F=la();f(b,F)};ht(Bt,b=>{a(D)?b(Wt):b(Yt,!1)})}f(T,A)},$$slots:{control:!0,panel:!0}})}),f(y,ft)},$$slots:{default:!0}})};ht(_o,c=>{o.saveFile&&c(mo)})}so(2),l(dt),l(U);var ho=p(U,2);Yo(ho,{get showOrigin(){return a(_)},get showPlayers(){return a(C)},get showBases(){return a(D)},get showFastTravel(){return a(L)},get showDungeons(){return a(R)},get showAlphaPals(){return a(at)},get showPredatorPals(){return a(et)},get map(){return a(z)},set map(c){E(z,c,!0)}}),l(Z),Et(()=>{Y(I,1,`flex items-center space-x-2 ${a(_)?"":"opacity-25"}`),Y(j,1,`flex items-center space-x-2 ${a(L)?"":"opacity-25"} `),tt(vt,"src",yt.fastTravel),w(t,a(rt)),Y(d,1,`flex items-center space-x-2 ${a(R)?"":"opacity-25"}`),tt(x,"src",yt.dungeon),w(Pt,a(nt)),Y(xt,1,`flex items-center space-x-2 ${a(at)?"":"opacity-25"}`),tt(Kt,"src",a(it)),w(fo,a(lt)),Y(Tt,1,`flex items-center space-x-2 ${a(et)?"":"opacity-25"}`),tt(to,"src",a(Dt)),w(go,a(ct))}),f(u,Z),uo()}To(["click"]);export{ga as component};
